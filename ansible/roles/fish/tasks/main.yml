---
- name: Create Config directory if not exists
  file:
    path: /home/{{ user.name }}/.config
    state: directory
    mode: "0755"

- name: Create fish directory if not exists
  file:
    path: /home/{{ user.name }}/.config/fish
    state: directory
    mode: "0755"

- name: Create functions fish directory if not exists
  file:
    path: /home/{{ user.name }}/.config/fish/functions
    state: directory
    mode: "0755"

- name: Set Configuration
  template:
    src: config.j2
    dest: /home/{{ user.name }}/.config/fish/config.fish

- name: use oh-my-fish
  shell: |
    curl -L https://get.oh-my.fish > install
    fish install --path=/home/{{ user.name }}/.local/share/omf --config=/home/{{ user.name }}/.config/omf
    exit 0

- name: Copy fish helper
  template:
    src: "{{ item }}.j2"
    dest: /home/{{ user.name }}/.config/fish/{{ item }}
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
  with_items:
    - aliases.fish

- name: Copy functions
  copy:
    src: "{{ item }}.j2"
    dest: /home/{{ user.name }}/.config/fish/functions/{{ item }}.fish
  with_items:
    - reload

- name: Install pure theme
  shell: |
    omf install pure
    ln -s $OMF_PATH/themes/pure/conf.d/pure.fish ~/.config/fish/conf.d/pure.fish
    ln -s $OMF_PATH/themes/pure/conf.d/_pure_init.fish ~/.config/fish/conf.d/pure_init.fish
    exit 0
